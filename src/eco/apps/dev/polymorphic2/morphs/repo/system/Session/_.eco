
std Module
{
    Behavior <- ($package core) NewBehavior
                    ~ name: 'a session morph'
                    ~ presenterFunction: $[ :(polymorphic) :stream :kernel |
                            stream withGraphicsDo: [ :graphics |
                                "(std io out << 'Redrawing session with extent ' << (((kernel payload) desktop) extent)) newline commit."
                                graphics in: (((polymorphic math geometry) Point Origin)
                                                    extent: (((kernel payload) desktop) extent))
                                        put: (kernel payload) desktopMorph.
                                graphics at: (kernel payload) hand position
                                        put: (kernel payload) handMorph.
                            ].
                    ] bind($package)
                    ~ build;

    State :: Classlike {
        Instance :: Clonable
        {
            |
                handMorph,
                desktopMorph,
            |

            {
                protected polymorphic <- $package;

                initWithDriver: driver => (
                    handMorph    <- (((polymorphic morphs) repo system) Hand) Driver: driver.
                    desktopMorph <- (((polymorphic morphs) repo system) Desktop) New.
                  ^ self
                );

                hand    => handMorph payload;
                desktop => desktopMorph payload;

                extent: extent => (
                    desktop extent: extent.
                  ^ self
                );

                writeOn: w => w << 'a session';
            }
        };

        Driver: driver => (Instance clone) initWithDriver: driver;
    };

    Driver: driver => Behavior link: (State Driver: driver);
}
